<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi√™u b√†i th·ª© n</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800;900&family=Space+Grotesk:wght@400;500;600;700&family=Unbounded:wght@500;700&family=Caveat:wght@700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-1: #ffb3de;
            --bg-2: #cfb2ff;
            --bg-3: #ffe08a;
            --ink: #2b1d1a;
            --muted: #6b5f5c;
            --ok: #1fbf9c;
            --ok-deep: #13846d;
            --no: #c4c8d1;
            --no-deep: #8a94a7;
            --rose: #ff6aa9;
            --petal: #ffcfdd;
            --sky: #dff4ff;
            --locket: #ff8a00;
            --card: rgb(255, 255, 255);
            --shadow: 0 24px 70px rgba(31, 31, 46, 0.18);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            min-height: 100vh;
            display: grid;
            place-items: center;
            font-family: "Space Grotesk", "Segoe UI", sans-serif;
            color: var(--ink);
            background:
                linear-gradient(135deg, var(--bg-1), var(--bg-2) 45%, var(--bg-3));
            overflow: hidden;
        }

        body::before,
        body::after {
            content: "";
            position: fixed;
            width: 40vmax;
            height: 40vmax;
            border-radius: 50%;
            filter: blur(30px);
            opacity: 0.5;
            z-index: 0;
            display: none;
        }

        body::before {
            background: radial-gradient(circle, #ffe6f3 0%, transparent 70%);
            top: -10vmax;
            right: -8vmax;
            animation: blob-drift 19s ease-in-out infinite alternate;
        }

        body::after {
            background: radial-gradient(circle, #d4f5ff 0%, transparent 70%);
            bottom: -15vmax;
            left: -10vmax;
            animation: blob-drift 23s ease-in-out infinite alternate-reverse;
        }

        .pattern-layer {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            opacity: 0.38;
            display: none;
        }

        .floral-corner {
            position: fixed;
            z-index: 0;
            pointer-events: none;
            font-size: clamp(2.4rem, 5vw, 4rem);
            color: rgba(255, 255, 255, 0.55);
            text-shadow: 0 10px 24px rgba(75, 57, 88, 0.22);
            animation: sway 8s ease-in-out infinite;
        }

        .corner-a {
            top: 6vh;
            left: 7vw;
        }

        .corner-b {
            top: 10vh;
            right: 8vw;
            animation-delay: 1s;
        }

        .corner-c {
            bottom: 8vh;
            left: 10vw;
            animation-delay: 0.5s;
        }

        .corner-d {
            bottom: 9vh;
            right: 11vw;
            animation-delay: 1.4s;
        }

        .ambient-layer {
            position: fixed;
            inset: 0;
            z-index: 0;
            pointer-events: none;
            overflow: hidden;
        }

        .ambient-item {
            position: absolute;
            bottom: -12vh;
            left: 50vw;
            font-size: var(--size, 1.6rem);
            animation: drift-up var(--dur, 10s) linear forwards;
            opacity: 0.72;
            filter: blur(0.3px) drop-shadow(0 8px 14px rgba(40, 25, 44, 0.2));
            user-select: none;
        }

        .ambient-item.heart {
            color: var(--rose);
        }

        .ambient-item.flower {
            color: rgba(255, 130, 175, 0.88);
        }

        .ambient-item.locket {
            color: rgba(255, 145, 28, 0.95);
            text-shadow: 0 0 16px rgba(255, 166, 67, 0.45);
        }

        body.stage-misclick {
            background:
                radial-gradient(34vmax 26vmax at 10% 12%, rgba(255, 255, 255, 0.82), transparent 62%),
                radial-gradient(28vmax 28vmax at 85% 14%, rgba(232, 248, 255, 0.82), transparent 70%),
                linear-gradient(135deg, #d8f2ff, #ffe0f2 48%, #fff6c9);
        }

        body.stage-plea {
            background:
                radial-gradient(35vmax 28vmax at 15% 10%, rgba(255, 255, 255, 0.85), transparent 60%),
                radial-gradient(30vmax 26vmax at 85% 18%, rgba(255, 245, 233, 0.8), transparent 70%),
                linear-gradient(140deg, #ffd9a3, #ffbfbf 45%, #ffe6b8);
        }

        body.stage-compliment {
            background:
                radial-gradient(36vmax 29vmax at 14% 18%, rgba(255, 255, 255, 0.86), transparent 65%),
                radial-gradient(32vmax 28vmax at 88% 14%, rgba(255, 229, 242, 0.78), transparent 72%),
                linear-gradient(136deg, #ffc7dc, #ffdcb5 46%, #fff0be);
        }

        body.stage-challenge {
            background:
                radial-gradient(40vmax 30vmax at 12% 16%, rgba(255, 255, 255, 0.85), transparent 65%),
                radial-gradient(30vmax 30vmax at 85% 12%, rgba(214, 244, 255, 0.75), transparent 70%),
                linear-gradient(135deg, #bfe7ff, #ffc7e3 52%, #ffe49d);
        }

        .click-counter {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 0.45rem 0.9rem;
            background: rgba(30, 20, 20, 0.55);
            color: #fff;
            border-radius: 999px;
            font-size: 0.95rem;
            z-index: 2;
            letter-spacing: 0.02em;
        }

        .card {
            position: relative;
            z-index: 1;
            text-align: center;
            padding: 4.3rem 4rem 3.9rem;
            border-radius: 32px;
            background: var(--card);
            box-shadow: var(--shadow);
            border: 1px solid rgba(255, 255, 255, 0.62);
            max-width: 900px;
            width: min(95vw, 900px);
            transition: opacity 0.4s ease;
            overflow: hidden;
        }

        .card::before {
            content: "";
            position: absolute;
            inset: 14px;
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.72);
            background:
                radial-gradient(circle at 20% 28%, rgba(255, 231, 240, 0.7), transparent 38%),
                radial-gradient(circle at 78% 70%, rgba(225, 248, 255, 0.6), transparent 40%);
            pointer-events: none;
        }

        .card.hide {
            opacity: 0;
            pointer-events: none;
        }

        .card-view {
            width: 100%;
        }

        .card-view-prompt {
            position: relative;
        }

        .card-view[hidden] {
            display: none !important;
        }

        .card-view-thanks {
            min-height: 420px;
            display: grid;
            place-items: center;
            align-content: center;
            gap: 0.85rem;
            padding: 1rem 0 0.3rem;
            text-align: center;
            animation: pop 0.45s ease;
        }

        .card-view-thanks.show {
            display: grid;
        }

        .thanks-title {
            font-family: "Unbounded", "Space Grotesk", sans-serif;
            font-size: clamp(1.5rem, 3.8vw, 2.35rem);
            color: #ff4f9a;
            line-height: 1.15;
            text-shadow: 0 0 16px rgba(255, 118, 182, 0.4);
        }

        .thanks-text {
            font-family: "Caveat", "Space Grotesk", sans-serif;
            font-size: clamp(1.2rem, 2.8vw, 1.65rem);
            font-weight: 700;
            color: #5a4f54;
        }

        .thanks-gif {
            width: min(100%, 300px);
            border-radius: 20px;
            border: 2px solid rgba(255, 255, 255, 0.9);
            box-shadow: 0 14px 28px rgba(49, 33, 58, 0.22);
        }

        .avatar-sticker {
            width: fit-content;
            min-height: 56px;
            margin: 0 auto 0.95rem;
            padding: 0.55rem 1.1rem 0.55rem 0.8rem;
            border-radius: 999px;
            display: inline-flex;
            align-items: center;
            gap: 0.45rem;
            background:
                radial-gradient(circle at 30% 22%, rgba(255, 255, 255, 0.95), transparent 45%),
                linear-gradient(145deg, rgba(255, 171, 210, 0.9), rgba(255, 209, 127, 0.9));
            border: 3px solid rgba(255, 255, 255, 0.85);
            box-shadow: 0 18px 32px rgba(78, 40, 58, 0.22);
            position: relative;
            z-index: 1;
            cursor: pointer;
            user-select: none;
            animation: avatar-bob 5s ease-in-out infinite;
        }

        .avatar-face {
            font-size: 1.45rem;
            line-height: 1;
        }

        .avatar-greet {
            font-family: "Unbounded", "Space Grotesk", sans-serif;
            font-size: 0.92rem;
            font-weight: 700;
            color: #62384f;
            letter-spacing: 0.01em;
            line-height: 1.15;
        }

        .avatar-cam {
            font-size: 1.05rem;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.25));
        }

        .question {
            font-family: "Unbounded", "Space Grotesk", sans-serif;
            font-size: clamp(1.18rem, 1.6vw, 1.6rem);
            font-weight: 700;
            line-height: 1.24;
            margin-bottom: 0.72rem;
            letter-spacing: 0.01em;
            position: relative;
            z-index: 1;
        }

        .name-highlight {
            color: #ff4f9a;
            display: inline-block;
            letter-spacing: 0.05em;
            text-shadow: 0 0 18px rgba(255, 120, 179, 0.45);
            transition: color 0.24s ease, text-shadow 0.24s ease, filter 0.24s ease;
        }

        .name-highlight:hover {
            color: #ff2f8a;
            text-shadow: 0 0 24px rgba(255, 76, 164, 0.72);
            filter: saturate(1.12);
        }

        .locket-highlight {
            color: var(--locket);
            text-shadow: 0 0 18px rgba(255, 167, 82, 0.55);
        }

        .subtext {
            font-size: clamp(1.04rem, 1.6vw, 1.24rem);
            font-family: "Space Grotesk", sans-serif;
            font-weight: 700;
            letter-spacing: 0.02em;
            color: var(--muted);
            margin-bottom: 2.0rem;
            position: relative;
            z-index: 1;
        }

        .special-message,
        .disappear-message {
            font-family: "Unbounded", "Space Grotesk", sans-serif;
            font-weight: 700;
            font-size: clamp(1.6rem, 2.2vw, 1.7rem);
            line-height: 1.12;
            margin: 0.35rem auto 0.72rem;
            padding: 0.7rem 1.15rem;
            border-radius: 18px;
            color: #f0578a;
            display: none;
            animation: pop 0.5s ease;
            width: min(100%, 620px);
            position: relative;
            z-index: 1;
        }

        .special-message.show,
        .disappear-message.show {
            display: inline-block;
        }

        .message-gif {
            width: min(100%, 310px);
            height: auto;
            border-radius: 18px;
            border: 2px solid rgba(255, 255, 255, 0.78);
            box-shadow: 0 14px 28px rgba(49, 33, 58, 0.24);
            margin: 0.45rem auto 1.05rem;
            display: block;
            object-fit: cover;
            position: relative;
            z-index: 1;
        }

        .button-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            justify-items: center;
            align-items: center;
            gap: clamp(0.45rem, 1.4vw, 0.9rem);
            width: min(560px, 100%);
            min-height: 190px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
            overflow: visible;
        }

        .no-slot-ghost {
            display: none;
            grid-column: 2;
            width: 160px;
            height: 72px;
            border-radius: 999px;
            pointer-events: none;
            opacity: 0;
        }

        .plea-progress {
            margin-top: 1.4rem;
            position: relative;
            z-index: 1;
        }

        .progress-label {
            font-family: "Space Grotesk", "Segoe UI", sans-serif;
            font-size: 0.95rem;
            font-weight: 600;
            color: #514348;
            margin-bottom: 0.45rem;
        }

        .progress-track {
            width: min(460px, 88%);
            margin: 0 auto;
            height: 12px;
            border-radius: 999px;
            background: rgba(255, 255, 255, 0.65);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.08);
            overflow: hidden;
        }

        .progress-fill {
            width: 0%;
            height: 100%;
            border-radius: inherit;
            background: linear-gradient(90deg, #ff8c42, #ff5ca8 55%, #8a9dff);
            transition: width 0.35s ease;
        }

        button {
            border: none;
            min-width: 160px;
            min-height: 84px;
            padding: 0.55rem 1.2rem;
            --base-font-size: clamp(1.3rem, 1.5vw, 1.4rem);
            --font-scale: 1.3;
            font-size: calc(var(--base-font-size) * var(--font-scale));
            font-weight: 800;
            font-family: "Nunito", "Space Grotesk", "Segoe UI", sans-serif;
            letter-spacing: 0.02em;
            border-radius: 34px;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease, filter 0.2s ease;
            box-shadow: 0 14px 30px rgba(28, 32, 44, 0.18);
            touch-action: manipulation;
            transform: scale(var(--scale, 1));
            position: relative;
            overflow: visible;
            justify-self: center;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            text-align: center;
        }

        #okBtn {
            background: linear-gradient(145deg, #38d978 0%, #32cf72 45%, #24bb63 100%);
            color: #fff;
            grid-column: 1;
            letter-spacing: 0.01em;
            box-shadow:
                0 10px 22px rgba(13, 122, 76, 0.34),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -3px 8px rgba(0, 0, 0, 0.12);
            animation: ok-heartbeat 2s cubic-bezier(0.3, 0.06, 0.2, 1) infinite;
            z-index: 2;
            transform-origin: center;
            will-change: auto;
        }

        #okBtn::after {
            content: "";
            position: absolute;
            inset: -8px;
            border-radius: inherit;
            border: 2px solid rgba(70, 231, 142, 0.4);
            box-shadow: 0 0 0 0 rgba(56, 217, 120, 0.22);
            pointer-events: none;
            animation: ok-heart-glow 2s cubic-bezier(0.3, 0.06, 0.2, 1) infinite;
        }

        #okBtn:hover {
            filter: brightness(1.06);
            box-shadow:
                0 14px 24px rgba(13, 122, 76, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3),
                inset 0 -3px 8px rgba(0, 0, 0, 0.16);
        }

        #okBtn.giant {
            z-index: 2;
        }

        #noBtn {
            background: linear-gradient(145deg, #ff6b58, #ef4a38);
            color: #fff;
            grid-column: 2;
            --min-font-size: 1rem;
            font-size: max(var(--min-font-size), calc(var(--base-font-size) * var(--font-scale)));
            box-shadow: 0 12px 20px rgba(213, 69, 54, 0.34);
            --no-x: 0px;
            --no-y: 0px;
            --no-rot: 0deg;
            z-index: 2;
        }

        #noBtn.vanish {
            opacity: 0;
            animation: none !important;
            pointer-events: none;
        }

        .card-view-prompt.no-floating .no-slot-ghost {
            display: block;
        }

        .card-view-prompt.no-floating #noBtn {
            position: absolute;
            left: 50%;
            top: 62%;
            transform: translate(calc(-50% + var(--no-x)), calc(-50% + var(--no-y))) rotate(var(--no-rot)) scale(var(--scale, 1));
            transition: filter 0.2s ease, opacity 0.2s ease, box-shadow 0.2s ease;
            will-change: transform;
            z-index: 4;
        }

        .card-view-prompt.no-floating #noBtn:hover {
            filter: brightness(0.96);
        }

        .card-view-prompt.no-floating #noBtn.nervous {
            animation: none;
        }

        .card-view-prompt.no-floating #noBtn.vanish {
            transform: translate(calc(-50% + var(--no-x)), calc(-50% + var(--no-y))) rotate(var(--no-rot)) scale(0.2);
        }

        .button-row.only-ok {
            grid-template-columns: 1fr;
            justify-items: center;
            justify-content: center;
            min-height: 310px;
        }

        .button-row.only-ok #okBtn {
            grid-column: 1;
        }

        .button-row.only-ok #noBtn {
            display: none;
        }

        .celebration {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            background:
                radial-gradient(50vmax 40vmax at 10% 10%, rgba(255, 255, 255, 0.5), transparent 60%),
                linear-gradient(135deg, #ff8fb1, #ffc2a9 45%, #ffeaa7);
            z-index: 10;
            text-align: center;
            padding: 2rem;
        }

        .celebration.show {
            display: flex;
        }

        .celebration h2 {
            font-family: "Unbounded", "Space Grotesk", sans-serif;
            font-size: clamp(2.4rem, 6vw, 4.5rem);
            color: #fff;
            text-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
        }

        .celebration p {
            margin-top: 0.8rem;
            font-size: 1.3rem;
            color: #fffdf8;
        }

        .float-item {
            position: fixed;
            font-size: 2rem;
            pointer-events: none;
            animation: float-up 3.2s ease-in forwards;
        }

        .confetti-piece {
            position: fixed;
            top: -12vh;
            left: 50vw;
            width: 10px;
            height: 18px;
            border-radius: 4px;
            pointer-events: none;
            z-index: 11;
            animation: confetti-fall var(--fall, 3.2s) ease-in forwards;
        }

        @keyframes float-up {
            0% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% {
                opacity: 0;
                transform: translateY(-110vh) scale(0.2);
            }
        }

        @keyframes pop {
            0% {
                transform: scale(0.6);
                opacity: 0;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        @keyframes drift-up {
            0% {
                opacity: 0;
                transform: translate3d(0, 0, 0) scale(0.7) rotate(0deg);
            }
            12% {
                opacity: 0.92;
            }
            100% {
                opacity: 0;
                transform: translate3d(var(--drift, 24px), -120vh, 0) scale(1.2) rotate(var(--spin, 80deg));
            }
        }

        @keyframes sway {
            0%,
            100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-8px) rotate(6deg);
            }
        }

        @keyframes blob-drift {
            0% {
                transform: translate3d(0, 0, 0) scale(1);
                opacity: 0.48;
            }
            50% {
                transform: translate3d(-12px, 10px, 0) scale(1.05);
                opacity: 0.56;
            }
            100% {
                transform: translate3d(10px, -8px, 0) scale(1.02);
                opacity: 0.42;
            }
        }

        @keyframes pattern-drift {
            0% {
                transform: translate3d(0, 0, 0);
            }
            100% {
                transform: translate3d(-20px, 16px, 0);
            }
        }

        @keyframes ok-heartbeat {
            0%,
            100% {
                transform: scale(var(--scale, 1));
                box-shadow:
                    0 10px 22px rgba(13, 122, 76, 0.34),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3),
                    inset 0 -3px 8px rgba(0, 0, 0, 0.12);
            }
            50% {
                transform: scale(calc(var(--scale, 1) * 1.04));
                box-shadow:
                    0 12px 24px rgba(13, 122, 76, 0.38),
                    inset 0 1px 0 rgba(255, 255, 255, 0.3),
                    inset 0 -3px 9px rgba(0, 0, 0, 0.13);
            }
        }

        @keyframes ok-heart-glow {
            0%,
            100% {
                opacity: 0.15;
                transform: scale(0.99);
                box-shadow: 0 0 0 0 rgba(56, 217, 120, 0.1);
            }
            50% {
                opacity: 0.35;
                transform: scale(1.02);
                box-shadow: 0 0 0 6px rgba(56, 217, 120, 0.08);
            }
        }

        @keyframes pulse-ring {
            0% {
                opacity: 0.4;
                transform: scale(0.96);
            }
            80%,
            100% {
                opacity: 0;
                transform: scale(1.2);
            }
        }

        @keyframes no-shake {
            0%,
            100% {
                transform: translate(calc(-50% + var(--no-x)), calc(-50% + var(--no-y))) rotate(var(--no-rot)) scale(var(--scale, 1));
            }
            20% {
                transform: translate(calc(-50% + var(--no-x) - 5px), calc(-50% + var(--no-y))) rotate(calc(var(--no-rot) - 2deg)) scale(var(--scale, 1));
            }
            40% {
                transform: translate(calc(-50% + var(--no-x) + 4px), calc(-50% + var(--no-y))) rotate(calc(var(--no-rot) + 2deg)) scale(var(--scale, 1));
            }
            60% {
                transform: translate(calc(-50% + var(--no-x) - 3px), calc(-50% + var(--no-y))) rotate(calc(var(--no-rot) - 1.5deg)) scale(var(--scale, 1));
            }
            80% {
                transform: translate(calc(-50% + var(--no-x) + 3px), calc(-50% + var(--no-y))) rotate(calc(var(--no-rot) + 1.5deg)) scale(var(--scale, 1));
            }
        }

        @keyframes confetti-fall {
            0% {
                opacity: 1;
                transform: translate3d(0, 0, 0) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translate3d(var(--x, 0px), 110vh, 0) rotate(var(--rot, 500deg));
            }
        }

        @keyframes avatar-bob {
            0%,
            100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-6px);
            }
        }

        @media (max-width: 700px) {
            .card {
                padding: 2.2rem 1rem 1.9rem;
                border-radius: 26px;
                width: min(96vw, 520px);
            }

            .card::before {
                inset: 10px;
                border-radius: 18px;
            }

            .button-row {
                width: min(100%, 340px);
                min-height: 148px;
                gap: 0.5rem;
            }

            button {
                min-width: 122px;
                min-height: 54px;
                --base-font-size: 0.86rem;
                --font-scale: 1;
            }

            #okBtn {
                width: 122px;
                height: 54px;
                border-radius: 999px;
                --base-font-size: clamp(1rem, 5.2vw, 1.35rem);
            }

            #noBtn {
                width: 122px;
                height: 54px;
                --base-font-size: 0.84rem;
                --min-font-size: 0.72rem;
                --no-x: 0px;
            }

            .no-slot-ghost {
                width: 122px;
                height: 54px;
            }

            .floral-corner {
                font-size: clamp(1.8rem, 8vw, 2.6rem);
            }

            .avatar-sticker {
                min-height: 48px;
                padding: 0.48rem 0.82rem 0.48rem 0.65rem;
            }

            .avatar-face {
                font-size: 1.2rem;
            }

            .avatar-greet {
                font-size: 0.8rem;
            }

            .progress-track {
                width: min(360px, 95%);
            }

            .message-gif {
                width: min(100%, 250px);
            }

            .special-message,
            .disappear-message {
                font-size: clamp(1.1rem, 5vw, 2.2rem);
            }

            .question {
                font-size: clamp(1.06rem, 4.6vw, 1.48rem);
            }

            .card-view-thanks {
                min-height: 280px;
            }

            .thanks-gif {
                width: min(100%, 240px);
            }

            .button-row.only-ok {
                min-height: 220px;
            }
        }

        @media (prefers-reduced-motion: reduce) {
            * {
                animation: none !important;
                transition: none !important;
            }
        }
    </style>
</head>
<body>
    <div class="pattern-layer" aria-hidden="true"></div>
    <div class="ambient-layer" id="ambientLayer" aria-hidden="true"></div>
    <div class="floral-corner corner-a" aria-hidden="true">‚úø</div>
    <div class="floral-corner corner-b" aria-hidden="true">‚ùÄ</div>
    <div class="floral-corner corner-c" aria-hidden="true">‚ùÅ</div>
    <div class="floral-corner corner-d" aria-hidden="true">‚úΩ</div>

    <div class="click-counter" style="display: none;">L·∫ßn b·∫•m: <span id="clickCount">0</span></div>

    <main class="card" id="mainCard">
        <div class="card-view card-view-prompt" id="cardPrompt">
            <div class="special-message" id="specialMessage" aria-live="polite"></div>
            <div class="disappear-message" id="disappearMessage" aria-live="polite"></div>

            <img
                id="messageGif"
                class="message-gif"
                src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExZzQ1aWFtbjFyajRncDE4em95dzI2Y2I3bDk5dnI5YWZpcTI5MmJpbiZlcD12MV9naWZzX3NlYXJjaCZjdD1n/3oriO0OEd9QIDdllqo/giphy.gif"
                alt="Sticker d·ªÖ th∆∞∆°ng"
            >

            <div class="question"><span class="name-highlight">M·ªπ H√≤a</span> ∆°i, k·∫øt b·∫°n <span class="locket-highlight">Locket</span> l·∫°i v·ªõi tui nha nhaaa</div>
            <div class="subtext">B·∫•m OK gi√∫p tui nhen, tui ƒë·ªôi ∆°n <span class="name-highlight">M·ªπ H√≤a</span> lu√¥n.</div>

            <div class="button-row" id="buttonRow">
                <button id="okBtn">OK</button>
                <button id="noBtn">Kh√¥ng</button>
                <div id="noSlotGhost" class="no-slot-ghost" aria-hidden="true"></div>
            </div>
        </div>

        <div class="card-view card-view-thanks" id="cardThanks" hidden>
            <h2 class="thanks-title">C·∫£m ∆°n M·ªπ H√≤a nhi·ªÅu nhaa!</h2>
            <p class="thanks-text" id="thanksText">Tui vui qu√° tr·ªùi lu√¥n, m√£i iuuu.</p>
            <img
                class="thanks-gif"
                src="https://media1.tenor.com/m/YrTD3aW2BiEAAAAC/gaugauchutchut19.gif"
                alt="Sticker c·∫£m ∆°n d·ªÖ th∆∞∆°ng"
            >
        </div>
    </main>

    <section class="celebration" id="celebration">
        <h2>Yeahhhhhhh!</h2>
        <p>C·∫£m ∆°n <span class="name-highlight">M·ªπ H√≤a</span> nhi·ªÅu, m√£i iuuuuu.</p>
    </section>

    <script>
        const okBtn = document.getElementById("okBtn");
        const noBtn = document.getElementById("noBtn");
        const buttonRow = document.getElementById("buttonRow");
        const noSlotGhost = document.getElementById("noSlotGhost");
        const specialMessage = document.getElementById("specialMessage");
        const disappearMessage = document.getElementById("disappearMessage");
        const clickCountDisplay = document.getElementById("clickCount");
        const celebration = document.getElementById("celebration");
        const mainCard = document.getElementById("mainCard");
        const ambientLayer = document.getElementById("ambientLayer");
        const avatarSticker = document.getElementById("avatarSticker");
        const messageGif = document.getElementById("messageGif");
        const cardPrompt = document.getElementById("cardPrompt");
        const cardThanks = document.getElementById("cardThanks");

        const crushName = "M·ªπ H√≤a";
        const fallbackGif = "https://media.tenor.com/4EhUju6UJtEAAAAi/grrr-rawr.gif";
        const introMessage = {
            text: `Hey ${crushName}!`,
            gif: fallbackGif,
            gifAlt: "Sticker ch√†o d·ªÖ th∆∞∆°ng"
        };

        const stageMessages = {
            1: {
                text: `∆† ${crushName} b·∫•m nh·∫ßm r·ªìi ƒë√∫ng kh√¥ng, th·ª≠ n√∫t OK gi√∫p tui nha?`,
                stage: "misclick",
                gif: "https://media3.giphy.com/media/v1.Y2lkPTc5MGI3NjExMnRzZzAyYm9ucDFyZm5razdkNXg1YTB2ZTN3YTJjYXdhazM2ajQzbCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/FDbIUZLwbCUS4786z3/giphy.gif",
                gifAlt: "Sticker ng·∫°i ng√πng"
            },
            2: {
                text: `Kh√¥ng sao ƒë√¢u, b·∫•m l·∫°i c√°i l√† chu·∫©n b√†i li·ªÅn n√® ${crushName} ∆°i.`,
                stage: "misclick",
                gif: "https://media.tenor.com/C35t4Pf5GlgAAAAi/peach-and-goma-cute.gif",
                gifAlt: "Sticker xin x·ªè ƒë√°ng y√™u"
            },
            3: {
                text: `${crushName} ∆°i, cho tui k·∫øt b·∫°n Locket l·∫°i nha, tui nƒÉn n·ªâ ƒë√≥.`,
                stage: "plea",
                gif: "https://media1.tenor.com/m/pjBtpAFSnmgAAAAC/peach-goma-peach-and-goma.gif",
                gifAlt: "Sticker nƒÉn n·ªâ"
            },
            4: {
                text: `Tui m·ªùi ${crushName} tr√† s·ªØa nha, ƒë·ªïi l·∫°i b·∫•m OK gi√∫p tui v·ªõi.`,
                stage: "plea",
                gif: "https://media.tenor.com/pdv5YIMB-hkAAAAi/cute.gif",
                gifAlt: "Sticker ch·ªù ƒë·ª£i"
            },
            5: {
                text: `${crushName} c∆∞·ªùi c√°i l√† tui vui nguy√™n ng√†y, n√™n ƒë·ªìng √Ω nha.`,
                stage: "compliment",
                gif: "https://media.tenor.com/906nGAL7Xw0AAAAi/mochi-peachcat-cute-cat.gif",
                gifAlt: "Sticker tim bay"
            },
            6: {
                text: `${crushName} xinh ƒë·∫πp v√† d·ªÖ th∆∞∆°ng nh·∫•t h√¥m nay, ƒë·ªìng √Ω gi√∫p tui v·ªõi.`,
                stage: "compliment",
                gif: "https://media.tenor.com/kIKCUtlep0cAAAAi/hulkenberg.gif",
                gifAlt: "Sticker khen ng·ª£i"
            },
            7: {
                text: `Tui h·ª©a s·∫Ω kh√¥ng c√≥ l·∫ßn sau ƒë√¢u, M·ªπ H√≤a b·∫•m OK ƒëi nhaaa.`,
                stage: "compliment",
                gif: "https://media.tenor.com/hJazauQezk0AAAAi/yaseen1.gif",
                gifAlt: "Sticker l·ªùi h·ª©a"
            },
            8: {
                text: `Th√°ch ${crushName} b·∫•m Kh√¥ng ho√†i lu√¥n ƒë√≥, cu·ªëi c√πng v·∫´n v·ªÅ n√∫t OK th√¥i.`,
                stage: "challenge",
                gif: "https://media.tenor.com/nmkkpa49jGIAAAAi/cute.gif",
                gifAlt: "Sticker th·ª≠ th√°ch"
            },
            9: {
                text: `V√≤ng √°p ch√≥t r·ªìi n√® ${crushName}, b·∫•m OK ƒë·ªÉ tui kh·ªèi h·ªìi h·ªôp n·ªØa.`,
                stage: "challenge",
                gif: "https://media.tenor.com/SzjZCjI1kZQAAAAi/bubu-bubu-dudu.gif",
                gifAlt: "Sticker h·ªìi h·ªôp"
            },
            10: {
                text: `Ch·ªët h·∫° lu√¥n n√®, ${crushName} m√† b·∫•m Kh√¥ng n·ªØa l√† n√∫t ƒë√≥ bi·∫øn m·∫•t ƒë√≥ nha.`,
                stage: "challenge",
                gif: "https://media.tenor.com/kEF7qQM71RwAAAAi/peach-goma.gif",
                gifAlt: "Sticker ch·ªët h·∫°"
            }
        };

        let clickCount = 0;
        let okScale = 1;
        let messageTimer = null;
        let stageTimer = null;
        let activeStageClass = "";
        let audioCtx = null;
        let ambientTimer = null;
        let backgroundMusicTimer = null;
        let firstInteractionDone = false;
        let noFloating = false;
        let noMoveStep = 0;
        let noCurrentX = 0;
        let noCurrentY = 0;
        let noCurrentRot = 0;
        let noMotionRaf = null;
        let lastNoMoveTime = 0;

        const customMusicSrc = "";
        const customMusic = customMusicSrc ? new Audio(customMusicSrc) : null;

        const prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
        const supportsHover = window.matchMedia("(hover: hover)").matches;

        function setScale(el, scale) {
            el.style.setProperty("--scale", scale.toFixed(3));
            const fontScale = Math.max(0.72, 1 + (scale - 1) * 0.68);
            el.style.setProperty("--font-scale", fontScale.toFixed(3));
            if (el === okBtn) {
                updateCardForOkScale();
            }
        }

        function setNoPosition(x, y, rot) {
            noCurrentX = x;
            noCurrentY = y;
            noCurrentRot = rot;
            noBtn.style.setProperty("--no-x", `${x.toFixed(1)}px`);
            noBtn.style.setProperty("--no-y", `${y.toFixed(1)}px`);
            noBtn.style.setProperty("--no-rot", `${rot.toFixed(1)}deg`);
        }

        function animateNoTo(targetX, targetY, targetRot) {
            if (prefersReducedMotion) {
                setNoPosition(targetX, targetY, targetRot);
                return;
            }

            if (noMotionRaf) {
                cancelAnimationFrame(noMotionRaf);
                noMotionRaf = null;
            }

            const startX = noCurrentX;
            const startY = noCurrentY;
            const startRot = noCurrentRot;
            const start = performance.now();
            const duration = 260;

            const tick = (now) => {
                const t = Math.min(1, (now - start) / duration);
                const eased = 1 - Math.pow(1 - t, 3);

                const x = startX + (targetX - startX) * eased;
                const y = startY + (targetY - startY) * eased;
                const rot = startRot + (targetRot - startRot) * eased;
                setNoPosition(x, y, rot);

                if (t < 1) {
                    noMotionRaf = requestAnimationFrame(tick);
                } else {
                    noMotionRaf = null;
                }
            };

            noMotionRaf = requestAnimationFrame(tick);
        }

        function updateCardForOkScale() {
            const isMobileLayout = window.matchMedia("(max-width: 700px)").matches;
            if (isMobileLayout) {
                // Let the media-query CSS fully control size on small screens.
                mainCard.style.maxWidth = "";
                mainCard.style.width = "";
                buttonRow.style.width = "";
                buttonRow.style.minHeight = "";
                return;
            }

            const extraGrow = Math.max(0, okScale - 1);
            const dynamicWidth = Math.min(940, 760 + extraGrow * 120);
            const rowWidth = Math.min(760, 560 + extraGrow * 90);
            const rowHeight = Math.min(300, 190 + extraGrow * 45);
            mainCard.style.maxWidth = `${dynamicWidth}px`;
            mainCard.style.width = `min(97vw, ${dynamicWidth}px)`;
            buttonRow.style.width = `min(96vw, ${rowWidth}px)`;
            buttonRow.style.minHeight = `${rowHeight}px`;
        }

        function moveNoButtonRandom() {
            if (!cardPrompt || !cardPrompt.classList.contains("no-floating") || clickCount >= 10 || noBtn.classList.contains("vanish")) {
                return;
            }

            // Throttle: only move every 200ms to reduce computation
            const now = Date.now();
            if (now - lastNoMoveTime < 200) {
                return;
            }
            lastNoMoveTime = now;

            noMoveStep += 1;
            const viewRect = cardPrompt.getBoundingClientRect();
            const noRect = noBtn.getBoundingClientRect();
            const safeMarginX = Math.max(34, noRect.width * 1.05);
            const safeMarginTop = 28;
            const safeMarginBottom = 30;
            const maxX = Math.max(14, (viewRect.width / 2 - noRect.width / 2) - safeMarginX);

            const anchorY = viewRect.height * 0.66;
            const roomUp = Math.max(12, anchorY - noRect.height / 2 - safeMarginTop);
            const roomDown = Math.max(12, viewRect.height - anchorY - noRect.height / 2 - safeMarginBottom);
            const maxY = Math.max(10, Math.min(roomUp, roomDown));

            const progress = Math.min(1, Math.max(0, (clickCount - 2) / 8));
            const radiusX = Math.min(maxX, 14 + progress * (maxX * 0.72));
            const radiusY = Math.min(maxY, 8 + progress * (maxY * 0.66));

            const angle = noMoveStep * 2.3999632297 + (Math.random() - 0.5) * 0.22;
            const rawX = Math.cos(angle) * radiusX;
            const rawY = Math.sin(angle) * radiusY;

            const offsetX = Math.max(-maxX, Math.min(maxX, rawX));
            const offsetY = Math.max(-roomUp, Math.min(roomDown, rawY));
            const rotation = -5 + Math.random() * 10;

            animateNoTo(offsetX, offsetY, rotation);
        }

        function activateNoFloatingMode() {
            if (noFloating || clickCount < 2 || clickCount >= 10) {
                return;
            }
            noFloating = true;
            noMoveStep = 0;
            if (cardPrompt) {
                cardPrompt.classList.add("no-floating");
            }
            if (noSlotGhost) {
                noSlotGhost.style.display = "block";
            }
            moveNoButtonRandom();
        }

        function setMessageGif(src, alt = "Sticker d·ªÖ th∆∞∆°ng") {
            if (!messageGif || !src) {
                return;
            }
            messageGif.src = src;
            messageGif.alt = alt;
        }

        if (messageGif) {
            messageGif.addEventListener("error", () => {
                messageGif.src = fallbackGif;
                messageGif.alt = "Sticker d·ªÖ th∆∞∆°ng";
            });
        }

        function flashStage(stage) {
            const stageClass = `stage-${stage}`;
            if (activeStageClass && activeStageClass !== stageClass) {
                document.body.classList.remove(activeStageClass);
            }
            activeStageClass = stageClass;
            document.body.classList.add(stageClass);
            if (stageTimer) {
                clearTimeout(stageTimer);
            }
            stageTimer = setTimeout(() => {
                document.body.classList.remove(stageClass);
                if (activeStageClass === stageClass) {
                    activeStageClass = "";
                }
            }, 2200);
        }

        function showMessage(text, autoHide = false) {
            specialMessage.textContent = text;
            specialMessage.classList.add("show");
            if (messageTimer) {
                clearTimeout(messageTimer);
                messageTimer = null;
            }
            if (autoHide) {
                messageTimer = setTimeout(() => {
                    specialMessage.classList.remove("show");
                }, 2600);
            }
        }

        function showDisappear(text) {
            disappearMessage.textContent = text;
            disappearMessage.classList.add("show");
            specialMessage.classList.remove("show");
        }

        function showThankYouCard() {
            if (!cardPrompt || !cardThanks) {
                return;
            }

            cardPrompt.hidden = true;
            cardThanks.hidden = false;
            cardThanks.classList.add("show");
        }

        function getAudioContext() {
            if (!audioCtx) {
                audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            }
            return audioCtx;
        }

        function playTone(freq, duration, type = "sine", volume = 0.08, delay = 0) {
            const ctx = getAudioContext();
            if (ctx.state === "suspended") {
                ctx.resume();
            }

            const startAt = ctx.currentTime + delay;
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();

            oscillator.type = type;
            oscillator.frequency.setValueAtTime(freq, startAt);
            gainNode.gain.setValueAtTime(Math.max(0.001, volume), startAt);
            gainNode.gain.exponentialRampToValueAtTime(0.001, startAt + duration);

            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);
            oscillator.start(startAt);
            oscillator.stop(startAt + duration);
        }

        function playSlideTone(fromFreq, toFreq, duration, type = "triangle", volume = 0.08, delay = 0) {
            const ctx = getAudioContext();
            if (ctx.state === "suspended") {
                ctx.resume();
            }

            const startAt = ctx.currentTime + delay;
            const oscillator = ctx.createOscillator();
            const gainNode = ctx.createGain();

            oscillator.type = type;
            oscillator.frequency.setValueAtTime(Math.max(40, fromFreq), startAt);
            oscillator.frequency.exponentialRampToValueAtTime(Math.max(40, toFreq), startAt + duration);
            gainNode.gain.setValueAtTime(Math.max(0.001, volume), startAt);
            gainNode.gain.exponentialRampToValueAtTime(0.001, startAt + duration);

            oscillator.connect(gainNode);
            gainNode.connect(ctx.destination);
            oscillator.start(startAt);
            oscillator.stop(startAt + duration);
        }

        function playNoSound() {
            playSlideTone(360, 180, 0.16, "triangle", 0.09);
            playTone(240, 0.08, "square", 0.05, 0.08);
            playTone(180, 0.1, "triangle", 0.04, 0.16);
        }

        function playCelebrateSound() {
            [523, 659, 784, 1046].forEach((freq, index) => {
                playTone(freq, 0.2 + index * 0.02, "sine", 0.09, index * 0.06);
            });
            playSlideTone(310, 880, 0.28, "triangle", 0.06, 0.05);
            playSlideTone(390, 1200, 0.34, "triangle", 0.05, 0.15);
        }

        function startBackgroundMusic() {
            if (backgroundMusicTimer) {
                return;
            }

            if (customMusic) {
                customMusic.loop = true;
                customMusic.volume = 0.35;
                customMusic.play().catch(() => {});
                return;
            }

            const progression = [196, 220, 247, 175];
            let step = 0;

            const playBar = () => {
                const base = progression[step % progression.length];
                playTone(base, 0.74, "sine", 0.018);
                playTone(base * 1.5, 0.56, "triangle", 0.014, 0.12);
                playTone(base * 2, 0.24, "sine", 0.01, 0.32);
                step += 1;
            };

            playBar();
            backgroundMusicTimer = setInterval(playBar, 1400);
        }

        function triggerFirstInteraction() {
            if (firstInteractionDone) {
                return;
            }
            firstInteractionDone = true;
            startBackgroundMusic();
        }

        function sprinkleHearts() {
            const items = ["üíñ", "‚ú®", "üíó", "üíû", "üå∏", "üì∑"];
            const count = prefersReducedMotion ? 8 : 16;
            for (let i = 0; i < count; i += 1) {
                const item = document.createElement("div");
                item.className = "float-item";
                item.textContent = items[Math.floor(Math.random() * items.length)];
                item.style.left = `${Math.random() * 100}vw`;
                item.style.top = "105vh";
                item.style.fontSize = `${1.2 + Math.random() * 1.6}rem`;
                item.style.animationDuration = `${2.4 + Math.random() * 1.8}s`;
                document.body.appendChild(item);
                setTimeout(() => item.remove(), 4200);
            }
        }

        function launchConfetti() {
            const colors = ["#ff8a00", "#ff5ca8", "#ffd166", "#7bdff2", "#ffffff", "#9f7cff"];
            const count = prefersReducedMotion ? 12 : 28;

            for (let i = 0; i < count; i += 1) {
                const piece = document.createElement("span");
                piece.className = "confetti-piece";
                piece.style.left = `${Math.random() * 100}vw`;
                piece.style.width = `${7 + Math.random() * 7}px`;
                piece.style.height = `${10 + Math.random() * 12}px`;
                piece.style.background = colors[Math.floor(Math.random() * colors.length)];
                piece.style.setProperty("--x", `${-110 + Math.random() * 220}px`);
                piece.style.setProperty("--rot", `${220 + Math.random() * 720}deg`);
                piece.style.setProperty("--fall", `${2.6 + Math.random() * 1.8}s`);
                document.body.appendChild(piece);
                setTimeout(() => piece.remove(), 4700);
            }
        }

        function spawnAmbientItem() {
            if (!ambientLayer) {
                return;
            }

            const pool = ["üíñ", "üíó", "üíû", "üå∏", "üå∫", "üåº", "‚ùÄ", "‚úø", "üì∑"];
            const token = pool[Math.floor(Math.random() * pool.length)];
            const item = document.createElement("span");
            const duration = 8 + Math.random() * 7;

            item.className = "ambient-item";
            if (token === "üì∑") {
                item.classList.add("locket");
            } else if (token === "üíñ" || token === "üíó" || token === "üíû") {
                item.classList.add("heart");
            } else {
                item.classList.add("flower");
            }

            item.textContent = token;
            item.style.left = `${Math.random() * 100}vw`;
            item.style.setProperty("--size", `${1 + Math.random() * 1.7}rem`);
            item.style.setProperty("--dur", `${duration}s`);
            item.style.setProperty("--drift", `${-48 + Math.random() * 96}px`);
            item.style.setProperty("--spin", `${-120 + Math.random() * 240}deg`);
            item.style.opacity = `${0.35 + Math.random() * 0.55}`;
            ambientLayer.appendChild(item);

            setTimeout(() => item.remove(), (duration + 1) * 1000);
        }

        function startAmbient() {
            if (prefersReducedMotion || ambientTimer) {
                return;
            }

            for (let i = 0; i < 6; i += 1) {
                setTimeout(spawnAmbientItem, i * 400);
            }

            ambientTimer = setInterval(spawnAmbientItem, 1600);
        }

        function setupNoButtonNervous() {
            return;
        }

        function applyStageMessage(count) {
            const stageInfo = stageMessages[count];
            if (!stageInfo) {
                return;
            }

            showMessage(stageInfo.text);
            flashStage(stageInfo.stage);
            setMessageGif(stageInfo.gif || fallbackGif, stageInfo.gifAlt || "Sticker d·ªÖ th∆∞∆°ng");
        }

        startAmbient();
        setupNoButtonNervous();
        setNoPosition(0, 0, 0);
        showMessage(introMessage.text);
        setMessageGif(introMessage.gif, introMessage.gifAlt);
        updateCardForOkScale();

        let resizeTimeout = null;
        window.addEventListener("resize", () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                updateCardForOkScale();
                if (noFloating && clickCount >= 2 && clickCount < 10) {
                    moveNoButtonRandom();
                }
            }, 150);
        });

        if (avatarSticker) {
            avatarSticker.addEventListener("click", () => {
                triggerFirstInteraction();
                showMessage(`Hi ${crushName} n√®, ƒë·ªçc h·∫øt r·ªìi b·∫•m OK gi√∫p tui nha.`);
                sprinkleHearts();
                playTone(680, 0.12, "sine", 0.07);
            });
        }

        noBtn.addEventListener("click", () => {
            if (clickCount >= 10) {
                return;
            }

            triggerFirstInteraction();
            playNoSound();

            clickCount += 1;
            clickCountDisplay.textContent = clickCount;
            applyStageMessage(clickCount);

            // Start random movement from the 2nd "Kh√¥ng" click.
            if (clickCount >= 2 && clickCount < 10) {
                activateNoFloatingMode();
                moveNoButtonRandom();
            }

            // Behavior before or at 5th "Kh√¥ng": shrink the No button gradually,
            // and grow OK on each of those clicks (keeps position unchanged).
            if (clickCount <= 5) {
                // Shrink moderately so button stays readable and less jarring.
                const noScale = Math.max(0.55, 1 - 0.1 * clickCount);
                setScale(noBtn, noScale);

                // OK grows on each No click up to the 5th
                okScale *= 1.13;
                setScale(okBtn, okScale);
            }

            // After the 5th click, OK only grows every 2 No-clicks.
            else if (clickCount < 10) {
                // every 2 No-clicks after the 5th, grow OK once
                if ((clickCount - 5) % 2 === 0) {
                    okScale *= 1.13;
                    setScale(okBtn, okScale);
                }
            }

            // On the 10th click, finalize: hide/move No away and emphasize OK centered
            if (clickCount === 10) {
                if (noMotionRaf) {
                    cancelAnimationFrame(noMotionRaf);
                    noMotionRaf = null;
                }
                noBtn.classList.remove("nervous");
                noBtn.classList.add("vanish");
                if (cardPrompt) {
                    cardPrompt.classList.remove("no-floating");
                }
                buttonRow.classList.add("only-ok");
                noFloating = false;
                if (noSlotGhost) {
                    noSlotGhost.remove();
                }

                // ensure OK is large enough and centered
                okScale = Math.max(okScale, 2.4);
                setScale(okBtn, okScale);
                okBtn.classList.add("giant");

                showDisappear(`Ch·∫°y tr·ªùi kh√¥ng kh·ªèi n·∫Øng r·ªìi ${crushName} ∆°i, ch·ªâ c√≤n n√∫t OK th√¥i!`);

            }
        });

        okBtn.addEventListener("click", () => {
            triggerFirstInteraction();
            showThankYouCard();
            sprinkleHearts();
            launchConfetti();
            playCelebrateSound();
        });
    </script>
</body>
</html>
